{% extends "medicalform/layout.html" %}
{% block content %}
<div class="container" style="font-size: x-large;">
    <div class="row" style="margin-top: 40px;">
        <div class="col col-md-12 text-center center">
            <p>Xin mời chọn ngôn ngữ!</p>
            <p>请选择您的语言!</p>
            <p>Please choose your language!</p>

        </div>
    </div>
    <div class="row" style="margin-top: 20px;">
        <div class="col-4 col-sm-4 col-xs-4 col-md-4 col-lg-4 text-center">
            <a id="vi" href="#">
                <img width="50px" src="/{{static_url}}/img/vietnam-flag-icon-256.png" /><br />
                <span>Việt&nbsp;Nam</span>
            </a>
        </div>
        <div class="col-4 col-sm-4 col-xs-4 col-md-4 col-lg-4 text-center">
            <a id="cn" href="#">
                <img width="50px" src="/{{static_url}}/img/china-flag-xs.png" /><br />
                <span>Chinese</span>
            </a>
        </div>
        <div class="col-4 col-sm-4 col-xs-4 col-md-4 col-lg-4 text-center">
            <a id="en" href="#">
                <img width="50px" src="/{{static_url}}/img/united-kingdom-flag-xs.png" /><br />
                <span>English</span>
            </a>
        </div>
    </div>
    <div>
        <label class="mt-5">Lịch sử kê khai</label></div>

    <div class="input-group mb-3">
        <input type="text" class="form-control inputSohochieu" placeholder="Nhập số hộ chiếu để xem lịch sử"
            aria-label="Nhập số hộ chiếu để xem lịch sử" aria-describedby="basic-addon2">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary timkiem" type="button"><i class="fa fa-search"
                    aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <div class="border pl-2 mb-5 lichsumoinhat" style="border-radius: 5px;position: relative;">
        <div class="border-bottom mt-2">Mã tờ khai: &nbsp;<u><a href="#" id="id"
                    style="color: red;"></a></u><a id="eye" href="#"
                style="font-size:0.7em;float: right;color: #212529;position: absolute;top:-3px;right:3px"><i
                    class="fa fa-eye" aria-hidden="true"></i></a></div>
        <div class="row">
            <div class="col-5" style="font-size: 0.7em;"><label>Họ và tên:</label><label style="float: right;"><i
                        class="fa fa-angle-double-right" aria-hidden="true"></i></label></div>
            <div class="col-7" style="font-size: 0.7em;"><label id="hoten"></label></div>
        </div>
        <div class="row">
            <div class="col-5" style="font-size: 0.7em;"><label>Ngày khai:</label><label style="float: right;"><i
                        class="fa fa-angle-double-right" aria-hidden="true"></i></label></div>
            <div class="col-7" style="font-size: 0.7em;"><label id="ngaykekhai"></label></div>
        </div>
    </div>
    <div id="lichsu"></div>

</div>

<script>

    $(document).ready(function () {
        var xemcodulieuko = localStorage.getItem('id'); 
        if (xemcodulieuko != "" && xemcodulieuko != null && xemcodulieuko != undefined) {
            localStorage.setItem('lichsu','1');
        }
        var lichSu = localStorage.getItem('lichsu');
        var id = null;
        var hoten = null;
        var ngaykekhai = null;
        var cuakhau_id = null;
        var ngon_ngu = null;
        if (lichSu != "" && lichSu != null && lichSu != undefined) {
            id = localStorage.getItem('id');
            ngaykekhai = localStorage.getItem('ngaykekhai');
            hoten = localStorage.getItem('hoten');
            ngon_ngu = localStorage.getItem('ngon_ngu')
            cuakhau_id = localStorage.getItem('cuakhau_id')

        }else{
            id = "{{id}}";
            ngaykekhai = "{{ngaykekhai}}";
            cuakhau_id = "{{cuakhau_id}}";
            hoten = "{{hoten}}";
            ngon_ngu = "{{ngon_ngu}}";
        }
        $('#id').text(id)
        $('#hoten').text(hoten)
        $('#ngaykekhai').text(ngaykekhai)


        $('#id').unbind('click').bind('click', function () {
            localStorage.setItem('lichsu', 1);
            window.location = location.origin + "/medicalform/form/"+ngon_ngu+"/"+cuakhau_id+"/history"
        })
        $('#eye').unbind('click').bind('click', function () {
            localStorage.setItem('lichsu', 1);
            window.location = location.origin + "/medicalform/form/"+ngon_ngu+"/"+cuakhau_id+"/history"
        })
        $('#vi').unbind('click').bind('click', function () {
            ngon_ngu = "vi"
            localStorage.removeItem('lichsu');
            window.location = location.origin + "/medicalform/form/"+ngon_ngu+"/"+cuakhau_id;
        })
        $('#cn').unbind('click').bind('click', function () {
            ngon_ngu = "cn"

            localStorage.removeItem('lichsu');
            window.location = location.origin + "/medicalform/form/"+ngon_ngu+"/"+cuakhau_id;
        })
        $('#en').unbind('click').bind('click', function () {
            ngon_ngu = "en"
            localStorage.removeItem('lichsu');
            window.location = location.origin + "/medicalform/form/"+ngon_ngu+"/"+cuakhau_id;
        })


        $('.timkiem').unbind('click').bind('click', function () {
            $.ajax({
                type: "POST",
                url: location.origin + "/api/v1/timkiem",
                data: JSON.stringify({
                    "hochieu": $('.inputSohochieu').val()
                }),
                contentType: "application/json",

                success: function (response) {
                    $('.lichsumoinhat').remove();
                    $('.lichsutimkiem').remove();

                    response.forEach(function (item, index) {
                        $('#lichsu').append(`<div class="border pl-2 mb-5 lichsutimkiem" style="border-radius: 5px;position: relative;">
                                        <div class="border-bottom mt-2">Mã tờ khai: &nbsp;<u><a href="${location.origin}+ "/medicalform/form/"+${item.ngon_ngu}+"/"+${item.cuakhau_id}+"/"+${item.id}" style="color: red;">${item.id}</a></u><a href="${location.origin}+ "/medicalform/form/"+${item.ngon_ngu}+"/"+${item.cuakhau_id}+"/"+${item.id}" style="font-size:0.7em;float: right;color: #212529;position: absolute;top:-3px;right:3px" ><i class="fa fa-eye" aria-hidden="true"></i></a></div>
                                        <div class="row">
                                            <div class="col-5" style="font-size: 0.7em;"><label>Họ và tên:</label><label style="float: right;"><i class="fa fa-angle-double-right" aria-hidden="true"></i></label></div>
                                            <div class="col-7" style="font-size: 0.7em;"><label>${item.hoten}</label></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-5" style="font-size: 0.7em;"><label>Ngày khai:</label><label style="float: right;"><i class="fa fa-angle-double-right" aria-hidden="true"></i></label></div>
                                            <div class="col-7" style="font-size: 0.7em;"><label>${item.ngaykekhai}</label></div>
                                        </div>
                                    </div>`)


                    })

                },
                error: function (response) {

                }
            });
        })
    })


</script>
{% endblock %}